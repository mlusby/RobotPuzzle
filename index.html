<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Robot Puzzle Game</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="alternate icon" href="favicon.svg">
    <link rel="mask-icon" href="favicon.svg" color="#666">
    <link rel="stylesheet" href="styles.css">
    <style>
        /* Development banner styles */
        .dev-banner {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(90deg, #ff6b6b, #4ecdc4);
            color: white;
            text-align: center;
            padding: 5px;
            font-size: 14px;
            font-weight: bold;
            z-index: 9999;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            display: none;
        }
        body.local-dev {
            margin-top: 35px; /* Account for dev banner */
        }
        body.local-dev .dev-banner {
            display: block;
        }
    </style>
</head>
<body>
    <div class="dev-banner">
        ðŸ”§ LOCAL DEVELOPMENT MODE - Testing Robot Puzzle Game with Mock Data
    </div>
    
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-content">
            <img src="robots_loading.png" alt="Loading..." class="loading-image">
            <h2>Loading Robot Puzzle</h2>
            <p>Preparing your game...</p>
            <div class="loading-spinner">
                <div class="spinner-dot"></div>
                <div class="spinner-dot"></div>
                <div class="spinner-dot"></div>
            </div>
        </div>
    </div>
    
    <div class="game-container" id="game-container" style="display: none;">
        <div class="game-header">
            <h1>Robot Puzzle</h1>
            <div class="game-info">
                <div class="board-selector">
                    <label>Round Type:</label>
                    <select id="round-type-selector">
                        <option value="new">New Rounds (Practice)</option>
                        <option value="solved">Competitive Rounds (Leaderboard)</option>
                    </select>
                    <button id="new-round-btn" class="game-btn primary">Load Round</button>
                </div>
                <div class="competitive-rounds-manager" id="competitive-rounds-manager" style="display: none;">
                    <label>Competitive Rounds:</label>
                    <select id="competitive-rounds-selector">
                        <option value="">Select a round...</option>
                    </select>
                    <button id="delete-round-btn" class="game-btn danger">Delete</button>
                </div>
                <div class="goal">
                    <span>Goal: Get the <span id="target-color">red</span> robot to the target square</span>
                    <div id="target-indicator" class="target-preview"></div>
                </div>
                <div class="controls">
                    <div class="move-counter">Moves: <span id="move-count">0</span></div>
                    <div class="round-info">
                        <span id="round-id" style="display: none;"></span>
                        <span id="personal-best" class="personal-best"></span>
                    </div>
                    <button id="reset-btn" class="game-btn secondary">Reset</button>
                    <button id="editor-btn" class="game-btn secondary">Board Configuration</button>
                    <div class="user-info">
                        <span id="user-email"></span>
                        <button id="sign-out-btn" class="game-btn secondary">Sign Out</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="game-board-container">
            <div id="game-board" class="game-board">
                <!-- Grid squares will be generated by JavaScript -->
            </div>
            <div id="target-square" class="target-square"></div>
        </div>
        
        <div class="leaderboard-section" id="leaderboard-section">
            <h3>Leaderboard</h3>
            <div id="leaderboard-display">
                <p>Complete a round to see the leaderboard!</p>
            </div>
            <div class="leaderboard-pagination" id="leaderboard-pagination" style="display: none;">
                <button id="prev-leaderboard-btn" class="game-btn secondary">Previous 5</button>
                <span id="leaderboard-page-info">Page 1</span>
                <button id="next-leaderboard-btn" class="game-btn secondary">Next 5</button>
            </div>
        </div>
    </div>

    <!-- Leaderboard Modal -->
    <div id="leaderboard-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Leaderboard</h2>
            <div id="leaderboard-content">
                <p>Complete a round to see the leaderboard!</p>
            </div>
        </div>
    </div>

    <!-- Round Completion Modal -->
    <div id="completion-modal" class="modal">
        <div class="modal-content">
            <h2>Round Complete!</h2>
            <div id="completion-content">
                <!-- Results will be populated here -->
            </div>
            <div class="completion-actions">
                <button id="new-round-completion-btn" class="game-btn primary">New Round</button>
                <button id="close-completion-btn" class="game-btn secondary">Continue</button>
            </div>
        </div>
    </div>
    
    <!-- Username Selection Modal -->
    <div id="username-modal" class="modal">
        <div class="modal-content">
            <h2>Choose Your Username</h2>
            <p>This username will be displayed on the leaderboard and associated with your scores.</p>
            <div class="username-form">
                <input type="text" id="username-input" placeholder="Enter your username" maxlength="20">
                <div class="username-actions">
                    <button id="save-username-btn" class="game-btn primary">Save Username</button>
                    <button id="skip-username-btn" class="game-btn secondary">Skip for Now</button>
                </div>
            </div>
            <p class="username-note">You can change your username later by clicking on your username.</p>
        </div>
    </div>
    
    <!-- Environment Detection (Always load first) -->
    <script src="js/environment.js"></script>
    
    <!-- Conditional Script Loading -->
    <script>
        // Load scripts based on environment
        if (ENV.isProduction()) {
            // Production: Load AWS SDK and config
            document.write('<script src="https://sdk.amazonaws.com/js/aws-sdk-2.1590.0.min.js"><\/script>');
            document.write('<script src="https://unpkg.com/amazon-cognito-identity-js@6.3.7/dist/amazon-cognito-identity.min.js"><\/script>');
            document.write('<script src="js/aws-config.js?v=' + Date.now() + '"><\/script>');
            document.write('<script src="js/auth-service.js"><\/script>');
        }
        
        // Apply environment-specific body class
        if (ENV.isDevelopment()) {
            document.body.classList.add('local-dev');
            // Development: Load auth service for local testing
            document.write('<script src="js/auth-service.js"><\/script>');
        }
    </script>
    
    <!-- Application Scripts (Always load) -->
    <script src="js/api-service.js?v=20250628230000"></script>
    <script src="script.js"></script>
</body>
</html>